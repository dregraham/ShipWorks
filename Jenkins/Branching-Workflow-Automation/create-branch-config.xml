<?xml version='1.0' encoding='UTF-8'?>
<project>
  <actions/>
  <description></description>
  <keepDependencies>false</keepDependencies>
  <properties>
    <hudson.model.ParametersDefinitionProperty>
      <parameterDefinitions>
        <hudson.model.StringParameterDefinition>
          <name>FEATURE_NAME</name>
          <description>A quick name to identify the list of jobs for this particular feature.</description>
          <defaultValue></defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>BRANCH_NAME</name>
          <description>The name of the branch in git that should be used to build from (e.g. master, integration, feature-xyz, etc.)</description>
          <defaultValue></defaultValue>
        </hudson.model.StringParameterDefinition>
      </parameterDefinitions>
    </hudson.model.ParametersDefinitionProperty>
  </properties>
  <scm class="hudson.plugins.git.GitSCM" plugin="git@2.0.1">
    <configVersion>2</configVersion>
    <userRemoteConfigs>
      <hudson.plugins.git.UserRemoteConfig>
        <url>//intfs01/development/Git/ShipWorks3x</url>
      </hudson.plugins.git.UserRemoteConfig>
    </userRemoteConfigs>
    <branches>
      <hudson.plugins.git.BranchSpec>
        <name>master</name>
      </hudson.plugins.git.BranchSpec>
    </branches>
    <doGenerateSubmoduleConfigurations>false</doGenerateSubmoduleConfigurations>
    <submoduleCfg class="list"/>
    <extensions/>
  </scm>
  <canRoam>true</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers/>
  <concurrentBuild>false</concurrentBuild>
  <customWorkspace>C:\jenkins-builds\create-branch-workflow</customWorkspace>
  <builders>
    <hudson.tasks.Shell>
      <command># Build the name of the registry key based on the workspace directory and the feature name
KEY=$(echo C:\\jenkins-builds\\@@BRANCH_NAME@@\\Artifacts\\Application | sed  -e &apos;s/@@BRANCH_NAME@@/&apos;$BRANCH_NAME&apos;/&apos;)

# Use the rake task to add the registry key with a randomly generated GUID value
# and write out the SQL session file to point to the seed database
rake setup:registry[$KEY] &quot;setup:sqlSession[$KEY,ShipWorks_SeedData]&quot;</command>
    </hudson.tasks.Shell>
    <hudson.tasks.Shell>
      <command># Create View
echo Feature name: $FEATURE_NAME

echo Submitting request to create view $FEATURE_NAME&quot;...&quot;
curl -d &apos;name=&apos;$FEATURE_NAME&apos;&amp;mode=hudson.model.ListView&amp;json={&quot;name&quot;: &quot;&apos;$FEATURE_NAME&apos;&quot;, &quot;mode&quot;: &quot;hudson.model.ListView&quot;}&apos; http://intdev1201:8080/createView &gt; /dev/null
echo $FEATURE_NAME view created

for CFG in $(ls ./Jenkins/Config/*_config.xml); do
	JOB=$(echo $(basename $CFG) | sed &apos;s/_config.xml$//g&apos;)
	JOB=${FEATURE_NAME}-$JOB
	sed -i &apos;s/@@BRANCH_NAME@@/&apos;$BRANCH_NAME&apos;/g&apos; $CFG
	sed -i &apos;s/@@FEATURE_NAME@@/&apos;$FEATURE_NAME&apos;/g&apos; $CFG
	
	echo Uploading job configuration for $JOB&quot;...&quot;
	curl -X POST -H &quot;Content-Type: text/xml&quot; --upload-file $CFG http://intdev1201:8080/createItem?name=$JOB &gt; /dev/null
	echo $JOB configuration uploaded
	
    # Add Job to View
	echo Adding $JOB to $FEATURE_NAME view...
    curl -d &apos;&apos; http://intdev1201:8080/view/$FEATURE_NAME/addJobToView?name=$JOB
	echo $JOB added to $FEATURE_NAME view
done

echo Jenkins is ready to build $FEATURE_NAME</command>
    </hudson.tasks.Shell>
  </builders>
  <publishers/>
  <buildWrappers/>
</project>