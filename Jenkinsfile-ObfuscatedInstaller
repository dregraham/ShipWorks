def BUILD_FOLDER = env.BRANCH_NAME.replaceAll('/', '-').replaceAll(' ', '-')

pipeline {
	agent {
		node {
			label 'windows'
			customWorkspace "c:/jenkins-builds/SOI_${BUILD_FOLDER}"
		}
	}
	stages {
		stage('Install prereqs') {
			steps {
				bat 'bundle install'
			}
		}
		stage('Build') {
			steps {
				echo "Build on ${NODE_NAME}"
				bat 'bundle exec rake build:public_installer[0.0.0]'
				archiveArtifacts artifacts: 'Artifacts/Distribute/*.*,Artifacts/Logs/*.*', fingerprint: true
			}
		}
	}
}