/*
Deployment script for BestRate

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
/*
:setvar DatabaseName "BestRate"
:setvar DefaultFilePrefix "BestRate"
:setvar DefaultDataPath ""
:setvar DefaultLogPath ""
*/

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Rename refactoring operation with key 0c74f1f2-5daf-4a3c-94d6-07ea7e9a1e58 is skipped, element [dbo].[ValidatedAddress].[Id] (SqlSimpleColumn) will not be renamed to ValidatedAddressID';


GO
PRINT N'Rename refactoring operation with key 4ed1e7a8-6e41-4a51-864b-f9934613b641 is skipped, element [dbo].[ValidatedAddress].[OrderID] (SqlSimpleColumn) will not be renamed to ConsumerID';


GO
PRINT N'Dropping FK_AmazonOrder_Order...';


GO
ALTER TABLE [dbo].[AmazonOrder] DROP CONSTRAINT [FK_AmazonOrder_Order];


GO
PRINT N'Dropping FK_ChannelAdvisorOrder_Order...';


GO
ALTER TABLE [dbo].[ChannelAdvisorOrder] DROP CONSTRAINT [FK_ChannelAdvisorOrder_Order];


GO
PRINT N'Dropping FK_ClickCartProOrder_Order...';


GO
ALTER TABLE [dbo].[ClickCartProOrder] DROP CONSTRAINT [FK_ClickCartProOrder_Order];


GO
PRINT N'Dropping FK_CommerceInterfaceOrder_Order...';


GO
ALTER TABLE [dbo].[CommerceInterfaceOrder] DROP CONSTRAINT [FK_CommerceInterfaceOrder_Order];


GO
PRINT N'Dropping FK_EbayOrder_Order...';


GO
ALTER TABLE [dbo].[EbayOrder] DROP CONSTRAINT [FK_EbayOrder_Order];


GO
PRINT N'Dropping FK_EtsyOrder_Order...';


GO
ALTER TABLE [dbo].[EtsyOrder] DROP CONSTRAINT [FK_EtsyOrder_Order];


GO
PRINT N'Dropping FK_MagentoOrder_Order...';


GO
ALTER TABLE [dbo].[MagentoOrder] DROP CONSTRAINT [FK_MagentoOrder_Order];


GO
PRINT N'Dropping FK_MarketworksOrder_Order...';


GO
ALTER TABLE [dbo].[MarketplaceAdvisorOrder] DROP CONSTRAINT [FK_MarketworksOrder_Order];


GO
PRINT N'Dropping FK_NetworkSolutionsOrder_Order...';


GO
ALTER TABLE [dbo].[NetworkSolutionsOrder] DROP CONSTRAINT [FK_NetworkSolutionsOrder_Order];


GO
PRINT N'Dropping FK_NeweggOrder_Order...';


GO
ALTER TABLE [dbo].[NeweggOrder] DROP CONSTRAINT [FK_NeweggOrder_Order];


GO
PRINT N'Dropping FK_Order_Customer...';


GO
ALTER TABLE [dbo].[Order] DROP CONSTRAINT [FK_Order_Customer];


GO
PRINT N'Dropping FK_Order_Store...';


GO
ALTER TABLE [dbo].[Order] DROP CONSTRAINT [FK_Order_Store];


GO
PRINT N'Dropping FK_OrderCharge_Order...';


GO
ALTER TABLE [dbo].[OrderCharge] DROP CONSTRAINT [FK_OrderCharge_Order];


GO
PRINT N'Dropping FK_OrderItem_Order...';


GO
ALTER TABLE [dbo].[OrderItem] DROP CONSTRAINT [FK_OrderItem_Order];


GO
PRINT N'Dropping FK_OrderMotionOrder_Order...';


GO
ALTER TABLE [dbo].[OrderMotionOrder] DROP CONSTRAINT [FK_OrderMotionOrder_Order];


GO
PRINT N'Dropping FK_OrderPaymentDetail_Order...';


GO
ALTER TABLE [dbo].[OrderPaymentDetail] DROP CONSTRAINT [FK_OrderPaymentDetail_Order];


GO
PRINT N'Dropping FK_PayPalOrder_Order...';


GO
ALTER TABLE [dbo].[PayPalOrder] DROP CONSTRAINT [FK_PayPalOrder_Order];


GO
PRINT N'Dropping FK_ProStoresOrder_Order...';


GO
ALTER TABLE [dbo].[ProStoresOrder] DROP CONSTRAINT [FK_ProStoresOrder_Order];


GO
PRINT N'Dropping FK_SearsOrder_Order...';


GO
ALTER TABLE [dbo].[SearsOrder] DROP CONSTRAINT [FK_SearsOrder_Order];


GO
PRINT N'Dropping FK_Shipment_Order...';


GO
ALTER TABLE [dbo].[Shipment] DROP CONSTRAINT [FK_Shipment_Order];


GO
PRINT N'Dropping FK_ShopifyOrder_Order...';


GO
ALTER TABLE [dbo].[ShopifyOrder] DROP CONSTRAINT [FK_ShopifyOrder_Order];


GO
PRINT N'Dropping FK_YahooOrder_Order...';


GO
ALTER TABLE [dbo].[YahooOrder] DROP CONSTRAINT [FK_YahooOrder_Order];


GO
PRINT N'Dropping FK_AmazonStore_Store...';


GO
ALTER TABLE [dbo].[AmazonStore] DROP CONSTRAINT [FK_AmazonStore_Store];


GO
PRINT N'Dropping FK_AmeriCommerceStore_Store...';


GO
ALTER TABLE [dbo].[AmeriCommerceStore] DROP CONSTRAINT [FK_AmeriCommerceStore_Store];


GO
PRINT N'Dropping FK_BigCommerceStore_Store...';


GO
ALTER TABLE [dbo].[BigCommerceStore] DROP CONSTRAINT [FK_BigCommerceStore_Store];


GO
PRINT N'Dropping FK_BuyComStore_Store...';


GO
ALTER TABLE [dbo].[BuyDotComStore] DROP CONSTRAINT [FK_BuyComStore_Store];


GO
PRINT N'Dropping FK_ChannelAdvisorStore_Store...';


GO
ALTER TABLE [dbo].[ChannelAdvisorStore] DROP CONSTRAINT [FK_ChannelAdvisorStore_Store];


GO
PRINT N'Dropping FK_Download_Store...';


GO
ALTER TABLE [dbo].[Download] DROP CONSTRAINT [FK_Download_Store];


GO
PRINT N'Dropping FK_EbayStore_Store...';


GO
ALTER TABLE [dbo].[EbayStore] DROP CONSTRAINT [FK_EbayStore_Store];


GO
PRINT N'Dropping FK_EtsyStore_Store...';


GO
ALTER TABLE [dbo].[EtsyStore] DROP CONSTRAINT [FK_EtsyStore_Store];


GO
PRINT N'Dropping FK_GenericFileStore_Store...';


GO
ALTER TABLE [dbo].[GenericFileStore] DROP CONSTRAINT [FK_GenericFileStore_Store];


GO
PRINT N'Dropping FK_GenericModuleStore_Store...';


GO
ALTER TABLE [dbo].[GenericModuleStore] DROP CONSTRAINT [FK_GenericModuleStore_Store];


GO
PRINT N'Dropping FK_InfopiaStore_InfopiaStore...';


GO
ALTER TABLE [dbo].[InfopiaStore] DROP CONSTRAINT [FK_InfopiaStore_InfopiaStore];


GO
PRINT N'Dropping FK_MarketworksStore_Store...';


GO
ALTER TABLE [dbo].[MarketplaceAdvisorStore] DROP CONSTRAINT [FK_MarketworksStore_Store];


GO
PRINT N'Dropping FK_NetworkSolutionsStore_Store...';


GO
ALTER TABLE [dbo].[NetworkSolutionsStore] DROP CONSTRAINT [FK_NetworkSolutionsStore_Store];


GO
PRINT N'Dropping FK_NeweggStore_Store...';


GO
ALTER TABLE [dbo].[NeweggStore] DROP CONSTRAINT [FK_NeweggStore_Store];


GO
PRINT N'Dropping FK_OrderMotionStore_Store...';


GO
ALTER TABLE [dbo].[OrderMotionStore] DROP CONSTRAINT [FK_OrderMotionStore_Store];


GO
PRINT N'Dropping FK_PayPalStore_Store...';


GO
ALTER TABLE [dbo].[PayPalStore] DROP CONSTRAINT [FK_PayPalStore_Store];


GO
PRINT N'Dropping FK_ProStoresStore_Store...';


GO
ALTER TABLE [dbo].[ProStoresStore] DROP CONSTRAINT [FK_ProStoresStore_Store];


GO
PRINT N'Dropping FK_SearsStore_Store...';


GO
ALTER TABLE [dbo].[SearsStore] DROP CONSTRAINT [FK_SearsStore_Store];


GO
PRINT N'Dropping FK_ShopifyStore_Store...';


GO
ALTER TABLE [dbo].[ShopifyStore] DROP CONSTRAINT [FK_ShopifyStore_Store];


GO
PRINT N'Dropping FK_StatusPreset_Store...';


GO
ALTER TABLE [dbo].[StatusPreset] DROP CONSTRAINT [FK_StatusPreset_Store];


GO
PRINT N'Dropping FK_StoreShopSite_Store...';


GO
ALTER TABLE [dbo].[ShopSiteStore] DROP CONSTRAINT [FK_StoreShopSite_Store];


GO
PRINT N'Dropping FK_ThreeDCartStore_Store...';


GO
ALTER TABLE [dbo].[ThreeDCartStore] DROP CONSTRAINT [FK_ThreeDCartStore_Store];


GO
PRINT N'Dropping FK_VolusionStore_Store...';


GO
ALTER TABLE [dbo].[VolusionStore] DROP CONSTRAINT [FK_VolusionStore_Store];


GO
PRINT N'Dropping FK_YahooStore_Store...';


GO
ALTER TABLE [dbo].[YahooStore] DROP CONSTRAINT [FK_YahooStore_Store];


GO
PRINT N'Starting rebuilding table [dbo].[Order]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Order] (
    [OrderID]                              BIGINT         IDENTITY (1006, 1000) NOT NULL,
    [RowVersion]                           ROWVERSION     NOT NULL,
    [StoreID]                              BIGINT         NOT NULL,
    [CustomerID]                           BIGINT         NOT NULL,
    [OrderNumber]                          BIGINT         NOT NULL,
    [OrderNumberComplete]                  NVARCHAR (50)  NOT NULL,
    [OrderDate]                            DATETIME       NOT NULL,
    [OrderTotal]                           MONEY          NOT NULL,
    [LocalStatus]                          NVARCHAR (100) NOT NULL,
    [IsManual]                             BIT            NOT NULL,
    [OnlineLastModified]                   DATETIME       NOT NULL,
    [OnlineCustomerID]                     SQL_VARIANT    NULL,
    [OnlineStatus]                         NVARCHAR (100) NOT NULL,
    [OnlineStatusCode]                     SQL_VARIANT    NULL,
    [RequestedShipping]                    NVARCHAR (50)  NOT NULL,
    [BillFirstName]                        NVARCHAR (30)  NOT NULL,
    [BillMiddleName]                       NVARCHAR (30)  NOT NULL,
    [BillLastName]                         NVARCHAR (30)  NOT NULL,
    [BillCompany]                          NVARCHAR (60)  NOT NULL,
    [BillStreet1]                          NVARCHAR (60)  NOT NULL,
    [BillStreet2]                          NVARCHAR (60)  NOT NULL,
    [BillStreet3]                          NVARCHAR (60)  NOT NULL,
    [BillCity]                             NVARCHAR (50)  NOT NULL,
    [BillStateProvCode]                    NVARCHAR (50)  NOT NULL,
    [BillPostalCode]                       NVARCHAR (20)  NOT NULL,
    [BillCountryCode]                      NVARCHAR (50)  NOT NULL,
    [BillPhone]                            NVARCHAR (25)  NOT NULL,
    [BillFax]                              NVARCHAR (35)  NOT NULL,
    [BillEmail]                            NVARCHAR (100) NOT NULL,
    [BillWebsite]                          NVARCHAR (50)  NOT NULL,
    [ShipFirstName]                        NVARCHAR (30)  NOT NULL,
    [ShipMiddleName]                       NVARCHAR (30)  NOT NULL,
    [ShipLastName]                         NVARCHAR (30)  NOT NULL,
    [ShipCompany]                          NVARCHAR (60)  NOT NULL,
    [ShipStreet1]                          NVARCHAR (60)  NOT NULL,
    [ShipStreet2]                          NVARCHAR (60)  NOT NULL,
    [ShipStreet3]                          NVARCHAR (60)  NOT NULL,
    [ShipCity]                             NVARCHAR (50)  NOT NULL,
    [ShipStateProvCode]                    NVARCHAR (50)  NOT NULL,
    [ShipPostalCode]                       NVARCHAR (20)  NOT NULL,
    [ShipCountryCode]                      NVARCHAR (50)  NOT NULL,
    [ShipPhone]                            NVARCHAR (25)  NOT NULL,
    [ShipFax]                              NVARCHAR (35)  NOT NULL,
    [ShipEmail]                            NVARCHAR (100) NOT NULL,
    [ShipWebsite]                          NVARCHAR (50)  NOT NULL,
    [ShipAddressValidationSuggestionCount] INT            NOT NULL,
    [ShipAddressValidationStatus]          INT            NOT NULL,
    [RollupItemCount]                      INT            NOT NULL,
    [RollupItemName]                       NVARCHAR (300) NULL,
    [RollupItemCode]                       NVARCHAR (300) NULL,
    [RollupItemSKU]                        NVARCHAR (100) NULL,
    [RollupItemLocation]                   NVARCHAR (255) NULL,
    [RollupItemQuantity]                   FLOAT (53)     NULL,
    [RollupItemTotalWeight]                FLOAT (53)     NOT NULL,
    [RollupNoteCount]                      INT            NOT NULL,
    [BillNameParseStatus]                  INT            NOT NULL,
    [BillUnparsedName]                     NVARCHAR (100) NOT NULL,
    [ShipNameParseStatus]                  INT            NOT NULL,
    [ShipUnparsedName]                     NVARCHAR (100) NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Order] PRIMARY KEY CLUSTERED ([OrderID] ASC)
);

ALTER TABLE [dbo].[tmp_ms_xx_Order]
    ADD CONSTRAINT [SD_Order_3e1466180be54546a233d292f00da376] DEFAULT 0 FOR [ShipAddressValidationSuggestionCount],
        CONSTRAINT [SD_Order_7fd2b255ef874d3bbdb19dd74a71be7a] DEFAULT 0 FOR [ShipAddressValidationStatus];

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Order])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Order] ON;
        INSERT INTO [dbo].[tmp_ms_xx_Order] ([OrderID], [StoreID], [CustomerID], [OrderNumber], [OrderNumberComplete], [OrderDate], [OrderTotal], [LocalStatus], [IsManual], [OnlineLastModified], [OnlineCustomerID], [OnlineStatus], [OnlineStatusCode], [RequestedShipping], [BillFirstName], [BillMiddleName], [BillLastName], [BillCompany], [BillStreet1], [BillStreet2], [BillStreet3], [BillCity], [BillStateProvCode], [BillPostalCode], [BillCountryCode], [BillPhone], [BillFax], [BillEmail], [BillWebsite], [ShipFirstName], [ShipMiddleName], [ShipLastName], [ShipCompany], [ShipStreet1], [ShipStreet2], [ShipStreet3], [ShipCity], [ShipStateProvCode], [ShipPostalCode], [ShipCountryCode], [ShipPhone], [ShipFax], [ShipEmail], [ShipWebsite], [RollupItemCount], [RollupItemName], [RollupItemCode], [RollupItemSKU], [RollupItemLocation], [RollupItemQuantity], [RollupItemTotalWeight], [RollupNoteCount], [BillNameParseStatus], [BillUnparsedName], [ShipNameParseStatus], [ShipUnparsedName])
        SELECT   [OrderID],
                 [StoreID],
                 [CustomerID],
                 [OrderNumber],
                 [OrderNumberComplete],
                 [OrderDate],
                 [OrderTotal],
                 [LocalStatus],
                 [IsManual],
                 [OnlineLastModified],
                 [OnlineCustomerID],
                 [OnlineStatus],
                 [OnlineStatusCode],
                 [RequestedShipping],
                 [BillFirstName],
                 [BillMiddleName],
                 [BillLastName],
                 [BillCompany],
                 [BillStreet1],
                 [BillStreet2],
                 [BillStreet3],
                 [BillCity],
                 [BillStateProvCode],
                 [BillPostalCode],
                 [BillCountryCode],
                 [BillPhone],
                 [BillFax],
                 [BillEmail],
                 [BillWebsite],
                 [ShipFirstName],
                 [ShipMiddleName],
                 [ShipLastName],
                 [ShipCompany],
                 [ShipStreet1],
                 [ShipStreet2],
                 [ShipStreet3],
                 [ShipCity],
                 [ShipStateProvCode],
                 [ShipPostalCode],
                 [ShipCountryCode],
                 [ShipPhone],
                 [ShipFax],
                 [ShipEmail],
                 [ShipWebsite],
                 [RollupItemCount],
                 [RollupItemName],
                 [RollupItemCode],
                 [RollupItemSKU],
                 [RollupItemLocation],
                 [RollupItemQuantity],
                 [RollupItemTotalWeight],
                 [RollupNoteCount],
                 [BillNameParseStatus],
                 [BillUnparsedName],
                 [ShipNameParseStatus],
                 [ShipUnparsedName]
        FROM     [dbo].[Order]
        ORDER BY [OrderID] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Order] OFF;
    END

ALTER TABLE [dbo].[tmp_ms_xx_Order] DROP CONSTRAINT [SD_Order_3e1466180be54546a233d292f00da376], CONSTRAINT [SD_Order_7fd2b255ef874d3bbdb19dd74a71be7a];

DROP TABLE [dbo].[Order];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Order]', N'Order';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Order]', N'PK_Order', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_BillCompany]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_BillCompany]
    ON [dbo].[Order]([BillCompany] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_BillCountryCode]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_BillCountryCode]
    ON [dbo].[Order]([BillCountryCode] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_BillEmail]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_BillEmail]
    ON [dbo].[Order]([BillEmail] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_BillLastName]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_BillLastName]
    ON [dbo].[Order]([BillLastName] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_BillPostalCode]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_BillPostalCode]
    ON [dbo].[Order]([BillPostalCode] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_BillStateProvCode]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_BillStateProvCode]
    ON [dbo].[Order]([BillStateProvCode] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_CustomerID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_CustomerID]
    ON [dbo].[Order]([CustomerID] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_LocalStatus]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_LocalStatus]
    ON [dbo].[Order]([LocalStatus] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_OnlineStatus]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_OnlineStatus]
    ON [dbo].[Order]([OnlineStatus] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_OrderDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_OrderDate]
    ON [dbo].[Order]([OrderDate] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_OrderNumber]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_OrderNumber]
    ON [dbo].[Order]([OrderNumber] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_OrderNumberComplete]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_OrderNumberComplete]
    ON [dbo].[Order]([OrderNumberComplete] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_OrderTotal]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_OrderTotal]
    ON [dbo].[Order]([OrderTotal] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_RequestedShipping]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_RequestedShipping]
    ON [dbo].[Order]([RequestedShipping] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_RollupItemCode]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_RollupItemCode]
    ON [dbo].[Order]([RollupItemCode] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_RollupItemCount]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_RollupItemCount]
    ON [dbo].[Order]([RollupItemCount] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_RollupItemName]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_RollupItemName]
    ON [dbo].[Order]([RollupItemName] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_RollupItemSKU]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_RollupItemSKU]
    ON [dbo].[Order]([RollupItemSKU] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_RollupNoteCount]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_RollupNoteCount]
    ON [dbo].[Order]([RollupNoteCount] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_ShipCompany]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_ShipCompany]
    ON [dbo].[Order]([ShipCompany] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_ShipCountryCode]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_ShipCountryCode]
    ON [dbo].[Order]([ShipCountryCode] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_ShipEmail]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_ShipEmail]
    ON [dbo].[Order]([ShipEmail] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_ShipLastName]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_ShipLastName]
    ON [dbo].[Order]([ShipLastName] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_ShipPostalCode]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_ShipPostalCode]
    ON [dbo].[Order]([ShipPostalCode] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_ShipStateProvCode]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_ShipStateProvCode]
    ON [dbo].[Order]([ShipStateProvCode] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_Auto_StoreID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Auto_StoreID]
    ON [dbo].[Order]([StoreID] ASC)
    INCLUDE([IsManual]);


GO
PRINT N'Creating [dbo].[Order].[IX_OnlineCustomerID]...';


GO
CREATE NONCLUSTERED INDEX [IX_OnlineCustomerID]
    ON [dbo].[Order]([OnlineCustomerID] ASC);


GO
PRINT N'Creating [dbo].[Order].[IX_OnlineLastModified_StoreID_IsManual]...';


GO
CREATE NONCLUSTERED INDEX [IX_OnlineLastModified_StoreID_IsManual]
    ON [dbo].[Order]([OnlineLastModified] DESC, [StoreID] ASC, [IsManual] ASC);


GO
ALTER TABLE [dbo].[Order] ENABLE CHANGE_TRACKING WITH (TRACK_COLUMNS_UPDATED = OFF);


GO
PRINT N'Starting rebuilding table [dbo].[Store]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Store] (
    [StoreID]                BIGINT         IDENTITY (1005, 1000) NOT NULL,
    [RowVersion]             ROWVERSION     NOT NULL,
    [License]                NVARCHAR (150) NOT NULL,
    [Edition]                NVARCHAR (MAX) NOT NULL,
    [TypeCode]               INT            NOT NULL,
    [Enabled]                BIT            NOT NULL,
    [SetupComplete]          BIT            NOT NULL,
    [StoreName]              NVARCHAR (75)  NOT NULL,
    [Company]                NVARCHAR (60)  NOT NULL,
    [Street1]                NVARCHAR (60)  NOT NULL,
    [Street2]                NVARCHAR (60)  NOT NULL,
    [Street3]                NVARCHAR (60)  NOT NULL,
    [City]                   NVARCHAR (50)  NOT NULL,
    [StateProvCode]          NVARCHAR (50)  NOT NULL,
    [PostalCode]             NVARCHAR (20)  NOT NULL,
    [CountryCode]            NVARCHAR (50)  NOT NULL,
    [Phone]                  NVARCHAR (25)  NOT NULL,
    [Fax]                    NVARCHAR (35)  NOT NULL,
    [Email]                  NVARCHAR (100) NOT NULL,
    [Website]                NVARCHAR (50)  NOT NULL,
    [AutoDownload]           BIT            NOT NULL,
    [AutoDownloadMinutes]    INT            NOT NULL,
    [AutoDownloadOnlyAway]   BIT            NOT NULL,
    [AutoAddressValidation]  BIT            NOT NULL,
    [ComputerDownloadPolicy] NVARCHAR (MAX) NOT NULL,
    [DefaultEmailAccountID]  BIGINT         NOT NULL,
    [ManualOrderPrefix]      NVARCHAR (10)  NOT NULL,
    [ManualOrderPostfix]     NVARCHAR (10)  NOT NULL,
    [InitialDownloadDays]    INT            NULL,
    [InitialDownloadOrder]   BIGINT         NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Store] PRIMARY KEY CLUSTERED ([StoreID] ASC)
);

ALTER TABLE [dbo].[tmp_ms_xx_Store]
    ADD CONSTRAINT [SD_Store_c5c0b37533dd4af79734767be542ba6d] DEFAULT 0 FOR [AutoAddressValidation];

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Store])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Store] ON;
        INSERT INTO [dbo].[tmp_ms_xx_Store] ([StoreID], [License], [Edition], [TypeCode], [Enabled], [SetupComplete], [StoreName], [Company], [Street1], [Street2], [Street3], [City], [StateProvCode], [PostalCode], [CountryCode], [Phone], [Fax], [Email], [Website], [AutoDownload], [AutoDownloadMinutes], [AutoDownloadOnlyAway], [ComputerDownloadPolicy], [DefaultEmailAccountID], [ManualOrderPrefix], [ManualOrderPostfix], [InitialDownloadDays], [InitialDownloadOrder])
        SELECT   [StoreID],
                 [License],
                 [Edition],
                 [TypeCode],
                 [Enabled],
                 [SetupComplete],
                 [StoreName],
                 [Company],
                 [Street1],
                 [Street2],
                 [Street3],
                 [City],
                 [StateProvCode],
                 [PostalCode],
                 [CountryCode],
                 [Phone],
                 [Fax],
                 [Email],
                 [Website],
                 [AutoDownload],
                 [AutoDownloadMinutes],
                 [AutoDownloadOnlyAway],
                 [ComputerDownloadPolicy],
                 [DefaultEmailAccountID],
                 [ManualOrderPrefix],
                 [ManualOrderPostfix],
                 [InitialDownloadDays],
                 [InitialDownloadOrder]
        FROM     [dbo].[Store]
        ORDER BY [StoreID] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Store] OFF;
    END

ALTER TABLE [dbo].[tmp_ms_xx_Store] DROP CONSTRAINT [SD_Store_c5c0b37533dd4af79734767be542ba6d];

DROP TABLE [dbo].[Store];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Store]', N'Store';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Store]', N'PK_Store', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[Store].[IX_Store_StoreName]...';


GO
CREATE UNIQUE NONCLUSTERED INDEX [IX_Store_StoreName]
    ON [dbo].[Store]([StoreName] ASC);


GO
ALTER TABLE [dbo].[Store] ENABLE CHANGE_TRACKING WITH (TRACK_COLUMNS_UPDATED = OFF);


GO
PRINT N'Creating [dbo].[Address]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TABLE [dbo].[Address] (
    [AddressID]     BIGINT        IDENTITY (1101, 1000) NOT NULL,
    [Street1]       NVARCHAR (60) NOT NULL,
    [Street2]       NVARCHAR (60) NOT NULL,
    [Street3]       NVARCHAR (60) NOT NULL,
    [City]          NVARCHAR (50) NOT NULL,
    [StateProvCode] NVARCHAR (50) NOT NULL,
    [PostalCode]    NVARCHAR (20) NOT NULL,
    [CountryCode]   NVARCHAR (50) NOT NULL,
    CONSTRAINT [PK_Address] PRIMARY KEY CLUSTERED ([AddressID] ASC)
);


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[ValidatedAddress]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TABLE [dbo].[ValidatedAddress] (
    [ValidatedAddressID] BIGINT IDENTITY (1100, 1000) NOT NULL,
    [ConsumerID]         BIGINT NOT NULL,
    [AddressID]          BIGINT NOT NULL,
    [IsOriginal]         BIT    NOT NULL,
    CONSTRAINT [PK_ValidatedAddress] PRIMARY KEY CLUSTERED ([ValidatedAddressID] ASC)
);


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating FK_AmazonOrder_Order...';


GO
ALTER TABLE [dbo].[AmazonOrder] WITH NOCHECK
    ADD CONSTRAINT [FK_AmazonOrder_Order] FOREIGN KEY ([OrderID]) REFERENCES [dbo].[Order] ([OrderID]);


GO
PRINT N'Creating FK_ChannelAdvisorOrder_Order...';


GO
ALTER TABLE [dbo].[ChannelAdvisorOrder] WITH NOCHECK
    ADD CONSTRAINT [FK_ChannelAdvisorOrder_Order] FOREIGN KEY ([OrderID]) REFERENCES [dbo].[Order] ([OrderID]);


GO
PRINT N'Creating FK_ClickCartProOrder_Order...';


GO
ALTER TABLE [dbo].[ClickCartProOrder] WITH NOCHECK
    ADD CONSTRAINT [FK_ClickCartProOrder_Order] FOREIGN KEY ([OrderID]) REFERENCES [dbo].[Order] ([OrderID]);


GO
PRINT N'Creating FK_CommerceInterfaceOrder_Order...';


GO
ALTER TABLE [dbo].[CommerceInterfaceOrder] WITH NOCHECK
    ADD CONSTRAINT [FK_CommerceInterfaceOrder_Order] FOREIGN KEY ([OrderID]) REFERENCES [dbo].[Order] ([OrderID]);


GO
PRINT N'Creating FK_EbayOrder_Order...';


GO
ALTER TABLE [dbo].[EbayOrder] WITH NOCHECK
    ADD CONSTRAINT [FK_EbayOrder_Order] FOREIGN KEY ([OrderID]) REFERENCES [dbo].[Order] ([OrderID]);


GO
PRINT N'Creating FK_EtsyOrder_Order...';


GO
ALTER TABLE [dbo].[EtsyOrder] WITH NOCHECK
    ADD CONSTRAINT [FK_EtsyOrder_Order] FOREIGN KEY ([OrderID]) REFERENCES [dbo].[Order] ([OrderID]);


GO
PRINT N'Creating FK_MagentoOrder_Order...';


GO
ALTER TABLE [dbo].[MagentoOrder] WITH NOCHECK
    ADD CONSTRAINT [FK_MagentoOrder_Order] FOREIGN KEY ([OrderID]) REFERENCES [dbo].[Order] ([OrderID]);


GO
PRINT N'Creating FK_MarketworksOrder_Order...';


GO
ALTER TABLE [dbo].[MarketplaceAdvisorOrder] WITH NOCHECK
    ADD CONSTRAINT [FK_MarketworksOrder_Order] FOREIGN KEY ([OrderID]) REFERENCES [dbo].[Order] ([OrderID]);


GO
PRINT N'Creating FK_NetworkSolutionsOrder_Order...';


GO
ALTER TABLE [dbo].[NetworkSolutionsOrder] WITH NOCHECK
    ADD CONSTRAINT [FK_NetworkSolutionsOrder_Order] FOREIGN KEY ([OrderID]) REFERENCES [dbo].[Order] ([OrderID]);


GO
PRINT N'Creating FK_NeweggOrder_Order...';


GO
ALTER TABLE [dbo].[NeweggOrder] WITH NOCHECK
    ADD CONSTRAINT [FK_NeweggOrder_Order] FOREIGN KEY ([OrderID]) REFERENCES [dbo].[Order] ([OrderID]);


GO
PRINT N'Creating FK_Order_Customer...';


GO
ALTER TABLE [dbo].[Order] WITH NOCHECK
    ADD CONSTRAINT [FK_Order_Customer] FOREIGN KEY ([CustomerID]) REFERENCES [dbo].[Customer] ([CustomerID]);


GO
PRINT N'Creating FK_Order_Store...';


GO
ALTER TABLE [dbo].[Order] WITH NOCHECK
    ADD CONSTRAINT [FK_Order_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_OrderCharge_Order...';


GO
ALTER TABLE [dbo].[OrderCharge] WITH NOCHECK
    ADD CONSTRAINT [FK_OrderCharge_Order] FOREIGN KEY ([OrderID]) REFERENCES [dbo].[Order] ([OrderID]);


GO
PRINT N'Creating FK_OrderItem_Order...';


GO
ALTER TABLE [dbo].[OrderItem] WITH NOCHECK
    ADD CONSTRAINT [FK_OrderItem_Order] FOREIGN KEY ([OrderID]) REFERENCES [dbo].[Order] ([OrderID]);


GO
PRINT N'Creating FK_OrderMotionOrder_Order...';


GO
ALTER TABLE [dbo].[OrderMotionOrder] WITH NOCHECK
    ADD CONSTRAINT [FK_OrderMotionOrder_Order] FOREIGN KEY ([OrderID]) REFERENCES [dbo].[Order] ([OrderID]);


GO
PRINT N'Creating FK_OrderPaymentDetail_Order...';


GO
ALTER TABLE [dbo].[OrderPaymentDetail] WITH NOCHECK
    ADD CONSTRAINT [FK_OrderPaymentDetail_Order] FOREIGN KEY ([OrderID]) REFERENCES [dbo].[Order] ([OrderID]);


GO
PRINT N'Creating FK_PayPalOrder_Order...';


GO
ALTER TABLE [dbo].[PayPalOrder] WITH NOCHECK
    ADD CONSTRAINT [FK_PayPalOrder_Order] FOREIGN KEY ([OrderID]) REFERENCES [dbo].[Order] ([OrderID]);


GO
PRINT N'Creating FK_ProStoresOrder_Order...';


GO
ALTER TABLE [dbo].[ProStoresOrder] WITH NOCHECK
    ADD CONSTRAINT [FK_ProStoresOrder_Order] FOREIGN KEY ([OrderID]) REFERENCES [dbo].[Order] ([OrderID]);


GO
PRINT N'Creating FK_SearsOrder_Order...';


GO
ALTER TABLE [dbo].[SearsOrder] WITH NOCHECK
    ADD CONSTRAINT [FK_SearsOrder_Order] FOREIGN KEY ([OrderID]) REFERENCES [dbo].[Order] ([OrderID]);


GO
PRINT N'Creating FK_Shipment_Order...';


GO
ALTER TABLE [dbo].[Shipment] WITH NOCHECK
    ADD CONSTRAINT [FK_Shipment_Order] FOREIGN KEY ([OrderID]) REFERENCES [dbo].[Order] ([OrderID]);


GO
PRINT N'Creating FK_ShopifyOrder_Order...';


GO
ALTER TABLE [dbo].[ShopifyOrder] WITH NOCHECK
    ADD CONSTRAINT [FK_ShopifyOrder_Order] FOREIGN KEY ([OrderID]) REFERENCES [dbo].[Order] ([OrderID]);


GO
PRINT N'Creating FK_YahooOrder_Order...';


GO
ALTER TABLE [dbo].[YahooOrder] WITH NOCHECK
    ADD CONSTRAINT [FK_YahooOrder_Order] FOREIGN KEY ([OrderID]) REFERENCES [dbo].[Order] ([OrderID]);


GO
PRINT N'Creating FK_AmazonStore_Store...';


GO
ALTER TABLE [dbo].[AmazonStore] WITH NOCHECK
    ADD CONSTRAINT [FK_AmazonStore_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_AmeriCommerceStore_Store...';


GO
ALTER TABLE [dbo].[AmeriCommerceStore] WITH NOCHECK
    ADD CONSTRAINT [FK_AmeriCommerceStore_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_BigCommerceStore_Store...';


GO
ALTER TABLE [dbo].[BigCommerceStore] WITH NOCHECK
    ADD CONSTRAINT [FK_BigCommerceStore_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_BuyComStore_Store...';


GO
ALTER TABLE [dbo].[BuyDotComStore] WITH NOCHECK
    ADD CONSTRAINT [FK_BuyComStore_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_ChannelAdvisorStore_Store...';


GO
ALTER TABLE [dbo].[ChannelAdvisorStore] WITH NOCHECK
    ADD CONSTRAINT [FK_ChannelAdvisorStore_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_Download_Store...';


GO
ALTER TABLE [dbo].[Download] WITH NOCHECK
    ADD CONSTRAINT [FK_Download_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]) ON DELETE CASCADE;


GO
PRINT N'Creating FK_EbayStore_Store...';


GO
ALTER TABLE [dbo].[EbayStore] WITH NOCHECK
    ADD CONSTRAINT [FK_EbayStore_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_EtsyStore_Store...';


GO
ALTER TABLE [dbo].[EtsyStore] WITH NOCHECK
    ADD CONSTRAINT [FK_EtsyStore_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_GenericFileStore_Store...';


GO
ALTER TABLE [dbo].[GenericFileStore] WITH NOCHECK
    ADD CONSTRAINT [FK_GenericFileStore_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_GenericModuleStore_Store...';


GO
ALTER TABLE [dbo].[GenericModuleStore] WITH NOCHECK
    ADD CONSTRAINT [FK_GenericModuleStore_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_InfopiaStore_InfopiaStore...';


GO
ALTER TABLE [dbo].[InfopiaStore] WITH NOCHECK
    ADD CONSTRAINT [FK_InfopiaStore_InfopiaStore] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_MarketworksStore_Store...';


GO
ALTER TABLE [dbo].[MarketplaceAdvisorStore] WITH NOCHECK
    ADD CONSTRAINT [FK_MarketworksStore_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_NetworkSolutionsStore_Store...';


GO
ALTER TABLE [dbo].[NetworkSolutionsStore] WITH NOCHECK
    ADD CONSTRAINT [FK_NetworkSolutionsStore_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_NeweggStore_Store...';


GO
ALTER TABLE [dbo].[NeweggStore] WITH NOCHECK
    ADD CONSTRAINT [FK_NeweggStore_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_OrderMotionStore_Store...';


GO
ALTER TABLE [dbo].[OrderMotionStore] WITH NOCHECK
    ADD CONSTRAINT [FK_OrderMotionStore_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_PayPalStore_Store...';


GO
ALTER TABLE [dbo].[PayPalStore] WITH NOCHECK
    ADD CONSTRAINT [FK_PayPalStore_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_ProStoresStore_Store...';


GO
ALTER TABLE [dbo].[ProStoresStore] WITH NOCHECK
    ADD CONSTRAINT [FK_ProStoresStore_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_SearsStore_Store...';


GO
ALTER TABLE [dbo].[SearsStore] WITH NOCHECK
    ADD CONSTRAINT [FK_SearsStore_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_ShopifyStore_Store...';


GO
ALTER TABLE [dbo].[ShopifyStore] WITH NOCHECK
    ADD CONSTRAINT [FK_ShopifyStore_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_StatusPreset_Store...';


GO
ALTER TABLE [dbo].[StatusPreset] WITH NOCHECK
    ADD CONSTRAINT [FK_StatusPreset_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]) ON DELETE CASCADE;


GO
PRINT N'Creating FK_StoreShopSite_Store...';


GO
ALTER TABLE [dbo].[ShopSiteStore] WITH NOCHECK
    ADD CONSTRAINT [FK_StoreShopSite_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_ThreeDCartStore_Store...';


GO
ALTER TABLE [dbo].[ThreeDCartStore] WITH NOCHECK
    ADD CONSTRAINT [FK_ThreeDCartStore_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_VolusionStore_Store...';


GO
ALTER TABLE [dbo].[VolusionStore] WITH NOCHECK
    ADD CONSTRAINT [FK_VolusionStore_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_YahooStore_Store...';


GO
ALTER TABLE [dbo].[YahooStore] WITH NOCHECK
    ADD CONSTRAINT [FK_YahooStore_Store] FOREIGN KEY ([StoreID]) REFERENCES [dbo].[Store] ([StoreID]);


GO
PRINT N'Creating FK_ValidatedAddress_Address...';


GO
ALTER TABLE [dbo].[ValidatedAddress] WITH NOCHECK
    ADD CONSTRAINT [FK_ValidatedAddress_Address] FOREIGN KEY ([AddressID]) REFERENCES [dbo].[Address] ([AddressID]);


GO
PRINT N'Creating [dbo].[FilterDirtyOrder]...';


GO
CREATE TRIGGER [dbo].[FilterDirtyOrder]
    ON [dbo].[Order]
    AFTER INSERT, DELETE, UPDATE
    AS  EXTERNAL NAME [ShipWorks.SqlServer].[Triggers].[FilterDirtyOrder]


GO
PRINT N'Creating [dbo].[OrderAuditTrigger]...';


GO
CREATE TRIGGER [dbo].[OrderAuditTrigger]
    ON [dbo].[Order]
    AFTER INSERT, DELETE, UPDATE
    AS  EXTERNAL NAME [ShipWorks.SqlServer].[Triggers].[OrderAuditTrigger]


GO
PRINT N'Creating [dbo].[OrderLabelTrigger]...';


GO
CREATE TRIGGER [dbo].[OrderLabelTrigger]
    ON [dbo].[Order]
    AFTER INSERT, DELETE, UPDATE
    AS  EXTERNAL NAME [ShipWorks.SqlServer].[Triggers].[OrderLabelTrigger]


GO
PRINT N'Creating [dbo].[OrderRollupTrigger]...';


GO
CREATE TRIGGER [dbo].[OrderRollupTrigger]
    ON [dbo].[Order]
    AFTER INSERT, DELETE, UPDATE
    AS  EXTERNAL NAME [ShipWorks.SqlServer].[Triggers].[OrderRollupTrigger]


GO
PRINT N'Creating [dbo].[StoreLabelTrigger]...';


GO
CREATE TRIGGER [dbo].[StoreLabelTrigger]
    ON [dbo].[Store]
    AFTER INSERT, DELETE, UPDATE
    AS  EXTERNAL NAME [ShipWorks.SqlServer].[Triggers].[StoreLabelTrigger]


GO
PRINT N'Creating [dbo].[Order].[StoreID].[AuditFormat]...';


GO
EXECUTE sp_addextendedproperty @name = N'AuditFormat', @value = N'4', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Order', @level2type = N'COLUMN', @level2name = N'StoreID';


GO
PRINT N'Creating [dbo].[Order].[StoreID].[AuditName]...';


GO
EXECUTE sp_addextendedproperty @name = N'AuditName', @value = N'Store', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Order', @level2type = N'COLUMN', @level2name = N'StoreID';


GO
PRINT N'Creating [dbo].[Order].[CustomerID].[AuditFormat]...';


GO
EXECUTE sp_addextendedproperty @name = N'AuditFormat', @value = N'4', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Order', @level2type = N'COLUMN', @level2name = N'CustomerID';


GO
PRINT N'Creating [dbo].[Order].[CustomerID].[AuditName]...';


GO
EXECUTE sp_addextendedproperty @name = N'AuditName', @value = N'Customer', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Order', @level2type = N'COLUMN', @level2name = N'CustomerID';


GO
PRINT N'Creating [dbo].[Order].[OrderNumber].[AuditFormat]...';


GO
EXECUTE sp_addextendedproperty @name = N'AuditFormat', @value = N'1', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Order', @level2type = N'COLUMN', @level2name = N'OrderNumber';


GO
PRINT N'Creating [dbo].[Order].[OrderNumberComplete].[AuditName]...';


GO
EXECUTE sp_addextendedproperty @name = N'AuditName', @value = N'Order Number', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Order', @level2type = N'COLUMN', @level2name = N'OrderNumberComplete';


GO
PRINT N'Creating [dbo].[Order].[OrderTotal].[AuditFormat]...';


GO
EXECUTE sp_addextendedproperty @name = N'AuditFormat', @value = N'2', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Order', @level2type = N'COLUMN', @level2name = N'OrderTotal';


GO
PRINT N'Creating [dbo].[Order].[OnlineCustomerID].[AuditFormat]...';


GO
EXECUTE sp_addextendedproperty @name = N'AuditFormat', @value = N'1', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Order', @level2type = N'COLUMN', @level2name = N'OnlineCustomerID';


GO
PRINT N'Creating [dbo].[Order].[OnlineStatusCode].[AuditFormat]...';


GO
EXECUTE sp_addextendedproperty @name = N'AuditFormat', @value = N'1', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Order', @level2type = N'COLUMN', @level2name = N'OnlineStatusCode';


GO
PRINT N'Creating [dbo].[Order].[BillStateProvCode].[AuditFormat]...';


GO
EXECUTE sp_addextendedproperty @name = N'AuditFormat', @value = N'5', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Order', @level2type = N'COLUMN', @level2name = N'BillStateProvCode';


GO
PRINT N'Creating [dbo].[Order].[BillStateProvCode].[AuditName]...';


GO
EXECUTE sp_addextendedproperty @name = N'AuditName', @value = N'BillState', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Order', @level2type = N'COLUMN', @level2name = N'BillStateProvCode';


GO
PRINT N'Creating [dbo].[Order].[BillCountryCode].[AuditFormat]...';


GO
EXECUTE sp_addextendedproperty @name = N'AuditFormat', @value = N'6', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Order', @level2type = N'COLUMN', @level2name = N'BillCountryCode';


GO
PRINT N'Creating [dbo].[Order].[BillCountryCode].[AuditName]...';


GO
EXECUTE sp_addextendedproperty @name = N'AuditName', @value = N'BillCountry', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Order', @level2type = N'COLUMN', @level2name = N'BillCountryCode';


GO
PRINT N'Creating [dbo].[Order].[ShipStateProvCode].[AuditFormat]...';


GO
EXECUTE sp_addextendedproperty @name = N'AuditFormat', @value = N'5', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Order', @level2type = N'COLUMN', @level2name = N'ShipStateProvCode';


GO
PRINT N'Creating [dbo].[Order].[ShipStateProvCode].[AuditName]...';


GO
EXECUTE sp_addextendedproperty @name = N'AuditName', @value = N'ShipState', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Order', @level2type = N'COLUMN', @level2name = N'ShipStateProvCode';


GO
PRINT N'Creating [dbo].[Order].[ShipCountryCode].[AuditFormat]...';


GO
EXECUTE sp_addextendedproperty @name = N'AuditFormat', @value = N'6', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Order', @level2type = N'COLUMN', @level2name = N'ShipCountryCode';


GO
PRINT N'Creating [dbo].[Order].[ShipCountryCode].[AuditName]...';


GO
EXECUTE sp_addextendedproperty @name = N'AuditName', @value = N'ShipCountry', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Order', @level2type = N'COLUMN', @level2name = N'ShipCountryCode';


GO
PRINT N'Creating [dbo].[Order].[BillNameParseStatus].[AuditFormat]...';


GO
EXECUTE sp_addextendedproperty @name = N'AuditFormat', @value = N'1', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Order', @level2type = N'COLUMN', @level2name = N'BillNameParseStatus';


GO
PRINT N'Creating [dbo].[Order].[ShipNameParseStatus].[AuditFormat]...';


GO
EXECUTE sp_addextendedproperty @name = N'AuditFormat', @value = N'1', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Order', @level2type = N'COLUMN', @level2name = N'ShipNameParseStatus';


GO
-- Refactoring step to update target server with deployed transaction logs

IF OBJECT_ID(N'dbo.__RefactorLog') IS NULL
BEGIN
    CREATE TABLE [dbo].[__RefactorLog] (OperationKey UNIQUEIDENTIFIER NOT NULL PRIMARY KEY)
    EXEC sp_addextendedproperty N'microsoft_database_tools_support', N'refactoring log', N'schema', N'dbo', N'table', N'__RefactorLog'
END
GO
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '0c74f1f2-5daf-4a3c-94d6-07ea7e9a1e58')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('0c74f1f2-5daf-4a3c-94d6-07ea7e9a1e58')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '4ed1e7a8-6e41-4a51-864b-f9934613b641')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('4ed1e7a8-6e41-4a51-864b-f9934613b641')

GO

GO
PRINT N'Checking existing data against newly created constraints';


GO
USE [$(DatabaseName)];


GO
ALTER TABLE [dbo].[AmazonOrder] WITH CHECK CHECK CONSTRAINT [FK_AmazonOrder_Order];

ALTER TABLE [dbo].[ChannelAdvisorOrder] WITH CHECK CHECK CONSTRAINT [FK_ChannelAdvisorOrder_Order];

ALTER TABLE [dbo].[ClickCartProOrder] WITH CHECK CHECK CONSTRAINT [FK_ClickCartProOrder_Order];

ALTER TABLE [dbo].[CommerceInterfaceOrder] WITH CHECK CHECK CONSTRAINT [FK_CommerceInterfaceOrder_Order];

ALTER TABLE [dbo].[EbayOrder] WITH CHECK CHECK CONSTRAINT [FK_EbayOrder_Order];

ALTER TABLE [dbo].[EtsyOrder] WITH CHECK CHECK CONSTRAINT [FK_EtsyOrder_Order];

ALTER TABLE [dbo].[MagentoOrder] WITH CHECK CHECK CONSTRAINT [FK_MagentoOrder_Order];

ALTER TABLE [dbo].[MarketplaceAdvisorOrder] WITH CHECK CHECK CONSTRAINT [FK_MarketworksOrder_Order];

ALTER TABLE [dbo].[NetworkSolutionsOrder] WITH CHECK CHECK CONSTRAINT [FK_NetworkSolutionsOrder_Order];

ALTER TABLE [dbo].[NeweggOrder] WITH CHECK CHECK CONSTRAINT [FK_NeweggOrder_Order];

ALTER TABLE [dbo].[Order] WITH CHECK CHECK CONSTRAINT [FK_Order_Customer];

ALTER TABLE [dbo].[Order] WITH CHECK CHECK CONSTRAINT [FK_Order_Store];

ALTER TABLE [dbo].[OrderCharge] WITH CHECK CHECK CONSTRAINT [FK_OrderCharge_Order];

ALTER TABLE [dbo].[OrderItem] WITH CHECK CHECK CONSTRAINT [FK_OrderItem_Order];

ALTER TABLE [dbo].[OrderMotionOrder] WITH CHECK CHECK CONSTRAINT [FK_OrderMotionOrder_Order];

ALTER TABLE [dbo].[OrderPaymentDetail] WITH CHECK CHECK CONSTRAINT [FK_OrderPaymentDetail_Order];

ALTER TABLE [dbo].[PayPalOrder] WITH CHECK CHECK CONSTRAINT [FK_PayPalOrder_Order];

ALTER TABLE [dbo].[ProStoresOrder] WITH CHECK CHECK CONSTRAINT [FK_ProStoresOrder_Order];

ALTER TABLE [dbo].[SearsOrder] WITH CHECK CHECK CONSTRAINT [FK_SearsOrder_Order];

ALTER TABLE [dbo].[Shipment] WITH CHECK CHECK CONSTRAINT [FK_Shipment_Order];

ALTER TABLE [dbo].[ShopifyOrder] WITH CHECK CHECK CONSTRAINT [FK_ShopifyOrder_Order];

ALTER TABLE [dbo].[YahooOrder] WITH CHECK CHECK CONSTRAINT [FK_YahooOrder_Order];

ALTER TABLE [dbo].[AmazonStore] WITH CHECK CHECK CONSTRAINT [FK_AmazonStore_Store];

ALTER TABLE [dbo].[AmeriCommerceStore] WITH CHECK CHECK CONSTRAINT [FK_AmeriCommerceStore_Store];

ALTER TABLE [dbo].[BigCommerceStore] WITH CHECK CHECK CONSTRAINT [FK_BigCommerceStore_Store];

ALTER TABLE [dbo].[BuyDotComStore] WITH CHECK CHECK CONSTRAINT [FK_BuyComStore_Store];

ALTER TABLE [dbo].[ChannelAdvisorStore] WITH CHECK CHECK CONSTRAINT [FK_ChannelAdvisorStore_Store];

ALTER TABLE [dbo].[Download] WITH CHECK CHECK CONSTRAINT [FK_Download_Store];

ALTER TABLE [dbo].[EbayStore] WITH CHECK CHECK CONSTRAINT [FK_EbayStore_Store];

ALTER TABLE [dbo].[EtsyStore] WITH CHECK CHECK CONSTRAINT [FK_EtsyStore_Store];

ALTER TABLE [dbo].[GenericFileStore] WITH CHECK CHECK CONSTRAINT [FK_GenericFileStore_Store];

ALTER TABLE [dbo].[GenericModuleStore] WITH CHECK CHECK CONSTRAINT [FK_GenericModuleStore_Store];

ALTER TABLE [dbo].[InfopiaStore] WITH CHECK CHECK CONSTRAINT [FK_InfopiaStore_InfopiaStore];

ALTER TABLE [dbo].[MarketplaceAdvisorStore] WITH CHECK CHECK CONSTRAINT [FK_MarketworksStore_Store];

ALTER TABLE [dbo].[NetworkSolutionsStore] WITH CHECK CHECK CONSTRAINT [FK_NetworkSolutionsStore_Store];

ALTER TABLE [dbo].[NeweggStore] WITH CHECK CHECK CONSTRAINT [FK_NeweggStore_Store];

ALTER TABLE [dbo].[OrderMotionStore] WITH CHECK CHECK CONSTRAINT [FK_OrderMotionStore_Store];

ALTER TABLE [dbo].[PayPalStore] WITH CHECK CHECK CONSTRAINT [FK_PayPalStore_Store];

ALTER TABLE [dbo].[ProStoresStore] WITH CHECK CHECK CONSTRAINT [FK_ProStoresStore_Store];

ALTER TABLE [dbo].[SearsStore] WITH CHECK CHECK CONSTRAINT [FK_SearsStore_Store];

ALTER TABLE [dbo].[ShopifyStore] WITH CHECK CHECK CONSTRAINT [FK_ShopifyStore_Store];

ALTER TABLE [dbo].[StatusPreset] WITH CHECK CHECK CONSTRAINT [FK_StatusPreset_Store];

ALTER TABLE [dbo].[ShopSiteStore] WITH CHECK CHECK CONSTRAINT [FK_StoreShopSite_Store];

ALTER TABLE [dbo].[ThreeDCartStore] WITH CHECK CHECK CONSTRAINT [FK_ThreeDCartStore_Store];

ALTER TABLE [dbo].[VolusionStore] WITH CHECK CHECK CONSTRAINT [FK_VolusionStore_Store];

ALTER TABLE [dbo].[YahooStore] WITH CHECK CHECK CONSTRAINT [FK_YahooStore_Store];

ALTER TABLE [dbo].[ValidatedAddress] WITH CHECK CHECK CONSTRAINT [FK_ValidatedAddress_Address];


GO
PRINT N'Update complete.';


GO
