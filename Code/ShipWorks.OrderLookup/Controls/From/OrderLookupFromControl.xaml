<UserControl
    x:Class="ShipWorks.OrderLookup.Controls.From.OrderLookupFromControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:ShipWorks.OrderLookup.Controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:sui="clr-namespace:ShipWorks.Shipping.UI.ValueConverters;assembly=ShipWorks.Shipping.UI"
    xmlns:sw="http://schemas.shipworks.com/sw"
    xmlns:ui="http://schemas.shipworks.com/ui"
    xmlns:from="clr-namespace:ShipWorks.OrderLookup.Controls.From"
    d:DesignWidth="800"
    mc:Ignorable="d"
    d:DataContext="{d:DesignInstance {x:Type from:OrderLookupFromViewModel}}"
    FontFamily="/ShipWorks.OrderLookup;component/#Roboto">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/ShipWorks.OrderLookup;component/Styles/OrderLookupStyle.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <sui:ShipmentTypeToOriginAddressesConverter x:Key="ShipmentTypeToOriginAddresses" />
            <sui:ShipmentTypeToAccountsConverter x:Key="ShipmentTypeToAccountsConverter" />
            <local:ShipmentTypeToOrderLookupTemplateConverter x:Key="ShipmentTypeToOrderLookupTemplateConverter" />
            <ui:BooleanToVisibilityConverter x:Key="BooleanToVisibility" />
            <ui:InvertBooleanConverter x:Key="InvertBoolean" />
            <ui:BooleanAndConverter x:Key="BooleanAndConverter" />
            <UserControl x:Key="AccountLabel">
                <StackPanel>
                    <TextBlock Style="{StaticResource FieldLabel}" Text="Account">
                        <TextBlock.Visibility>
                            <Binding Converter="{StaticResource BooleanToVisibility}" Path="Orchestrator.ShipmentAdapter.SupportsAccounts" />
                        </TextBlock.Visibility>
                    </TextBlock>
                </StackPanel>
            </UserControl>

            <UserControl x:Key="AccountComboBox">
                <StackPanel>
                    <ui:ShipWorksComboBox
                        x:Name="AccountDropDown"
                        ui:UpdateWhenMessageReceived.MessageType="{x:Type sw:ShippingAccountsChangedMessage}"
                        DisplayMemberPath="Description"
                        SelectedIndexWhenNull="{x:Static ui:RelativeIndex.First}"
                        SelectedValuePath="AccountId"
                        Style="{StaticResource FormComboBox}">
                        <ComboBox.SelectedValue>
                            <Binding Path="Orchestrator.ShipmentAdapter.AccountId" />
                        </ComboBox.SelectedValue>
                        <ComboBox.IsEnabled>
                            <MultiBinding Converter="{StaticResource BooleanAndConverter}">
                                <Binding Mode="OneWay" Path="Orchestrator.ShipmentAllowEditing" />
                                <Binding Converter="{StaticResource InvertBoolean}" Mode="OneWay" Path="Orchestrator.ShipmentAdapter.SupportsRateShopping" />
                            </MultiBinding>
                        </ComboBox.IsEnabled>
                        <ComboBox.Visibility>
                            <Binding Converter="{StaticResource BooleanToVisibility}" Path="Orchestrator.ShipmentAdapter.SupportsAccounts" />
                        </ComboBox.Visibility>
                        <ComboBox.ItemsSource>
                            <Binding
                                Converter="{StaticResource ShipmentTypeToAccountsConverter}"
                                Mode="OneWay"
                                Path="Orchestrator.ShipmentTypeCode" />
                        </ComboBox.ItemsSource>
                    </ui:ShipWorksComboBox>
                </StackPanel>
            </UserControl>

            <UserControl x:Key="BaseAddressControl">
                <StackPanel>
                    <TextBlock Style="{StaticResource Header}">Origin</TextBlock>
                    <ui:ShipWorksComboBox
                        x:Name="OriginDropDown"
                        ui:UpdateWhenMessageReceived.MessageType="{x:Type sw:OriginAddressChangedMessage}"
                        DisplayMemberPath="Key"
                        SelectedIndexWhenNull="{x:Static ui:RelativeIndex.Last}"
                        SelectedValuePath="Value"
                        Style="{StaticResource StackedFormComboBox}">
                        <ComboBox.IsEnabled>
                            <Binding Mode="OneWay" Path="Orchestrator.ShipmentAllowEditing" />
                        </ComboBox.IsEnabled>
                        <ComboBox.ItemsSource>
                            <Binding
                                Converter="{StaticResource ShipmentTypeToOriginAddresses}"
                                Mode="OneWay"
                                Path="Orchestrator.ShipmentTypeCode" />
                        </ComboBox.ItemsSource>
                        <ComboBox.SelectedValue>
                            <Binding Path="Orchestrator.ShipmentAdapter.Shipment.OriginOriginID" />
                        </ComboBox.SelectedValue>
                    </ui:ShipWorksComboBox>

                    <local:OrderLookupAddress>
                        <local:OrderLookupAddress.IsEnabled>
                            <Binding Mode="OneWay" Path="Orchestrator.ShipmentAllowEditing" />
                        </local:OrderLookupAddress.IsEnabled>
                    </local:OrderLookupAddress>
                </StackPanel>
            </UserControl>

            <DataTemplate x:Key="usps">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="85" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <TextBlock
                        Grid.Row="0"
                        Grid.Column="0"
                        Style="{StaticResource Header}"
                        Text="USPS" />

                    <ContentControl
                        Grid.Row="1"
                        Grid.Column="0"
                        Content="{StaticResource AccountLabel}" />
                    <CheckBox
                        Grid.Row="1"
                        Grid.Column="1"
                        Content="Automatically use the USPS account with the least expensive Rate"
                        Style="{StaticResource FormCheckBox}">
                        <CheckBox.IsEnabled>
                            <Binding Mode="OneWay" Path="Orchestrator.ShipmentAllowEditing" />
                        </CheckBox.IsEnabled>
                        <CheckBox.IsChecked>
                            <Binding Path="RateShop" />
                        </CheckBox.IsChecked>
                    </CheckBox>
                    <StackPanel Grid.Row="2" Grid.Column="1">
                        <ContentControl Content="{StaticResource AccountComboBox}" />
                    </StackPanel>
                    <StackPanel
                        Grid.Row="3"
                        Grid.Column="0"
                        Grid.ColumnSpan="2">
                        <ContentControl
                            Content="{StaticResource BaseAddressControl}" />
                    </StackPanel>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="default">
                <StackPanel>
                    <ContentControl Content="{StaticResource BaseAddressControl}" />
                </StackPanel>
            </DataTemplate>

        </ResourceDictionary>

    </UserControl.Resources>
    <Expander x:Name="Expander" Header="{Binding Title}">
        <StackPanel Style="{StaticResource PanelWrapper}">
            <ContentControl Content="{Binding .}">
                <ContentControl.ContentTemplate>
                    <MultiBinding Converter="{StaticResource ShipmentTypeToOrderLookupTemplateConverter}">
                    <Binding Path="Orchestrator.ShipmentTypeCode" />
                        <Binding RelativeSource="{RelativeSource Self}" />
                    </MultiBinding>
                </ContentControl.ContentTemplate>
            </ContentControl>
        </StackPanel>
    </Expander>
</UserControl>
